---
title: "Annual Report Data Analysis - Question 1"
author: "Cristin Young"
date: "2025-12-07"
output:
  html_document:
    df_print: paged
  pdf_document: default
  html_notebook: default
---

#Read in data
```{r}
library(tidyverse)
library(janitor)
library(gt)

demographic_data_filtered <- read_csv("/Users/cristin/CWS Dropbox/Cristin Young/CYBHI Project/Rebecca and Tristan and Cristin/EInsight Data/demographic_data_clean.csv", show_col_types = FALSE)
all_data <- read_csv("/Users/cristin/CWS Dropbox/Cristin Young/CYBHI Project/Rebecca and Tristan and Cristin/EInsight Data/demographic_discharge_clean.csv", show_col_types = FALSE)
```
#1. Did the EBP/CDEP Workstream increase access to services for targeted populations?

##1.01 Did improved access to services affect all subpopulations?

Cross-tab of study population by relevant demographic data

Total number of clients served and by demographics

###race
Cleaned race variable (recoded_race): 
- 0 if nothing is left after removal (or NA)
- 1 if exactly one valid response remains
- 2 if 2+ valid responses remain
Recoded race variable (code_num): 
codebook <- c("Asian" = 1, 
              "Black or African American" = 2, 
              "Hispanic or Latino" = 3,
              "Middle Eastern or North African" = 4,
              "Native American/American Indian or Alaska Native" = 5,
              "Native Hawaiian or Pacific Islander" = 6,
              "White" = 7,
              2+ selected = 88
              )
```{r}
all_data_filtered <- all_data %>% 
  filter(intervention_start >= "2024-01-01", 
         !is.na(intervention_start), # has to have an intervention start date
         !is.na(intervention_name))

all_data_filtered %>% 
  tabyl(code_num) %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_totals("row")
```

###ethnicity
Cleaned race variable (recoded_race): 
- 0 if nothing is left after removal (or NA)
- 1 if exactly one valid response remains
- 2 if 2+ valid responses remain
Recoded race variable (code_num): 
codebook_eth <- c("Chinese" = 1, "Asian Indian" = 2, "Filipino" = 3, "Vietnamese" = 4, "Korean" = 5,"Japanese" = 6, "African American" = 7,"Jamaican" = 8, "Haitian" = 9, "Nigerian" = 10, "Somali" = 11, "Mexican" = 12, "Puerto Rican" = 13, "Salvadoran" = 14, "Cuban" = 15, "Dominican" = 16, "Guatemalan" = 17, "Native Hawaiian" = 18, "Samoan" = 19, "Chamorro" = 20, "English" = 21, "German" = 22, "Irish" = 23, "Italian" = 24, "Polish" = 25, "Scottish" = 26, "2+ ethnicities selected" = 88)
```{r}
all_data_filtered %>% 
  tabyl(ethn_num) %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_totals("row")
```

###gender identity
```{r}
all_data_filtered %>% 
  tabyl(gender_identity) %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_totals("row")
```

###sexual orientation
```{r}
all_data_filtered %>% 
  tabyl(sexual_orientation) %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_totals("row")
```

###insurance status
```{r}
all_data_filtered %>% 
  tabyl(insurance_status) %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_totals("row")
```


##1.02 How does access differ compared to previous access to services before EBP/CDEP funding? For each subpopulation?

Cross-tab of demographics and grant types: Total number of clients served and by demographic, and by whether grant was start up or expansion
```{r}
glimpse(all_data)
```

